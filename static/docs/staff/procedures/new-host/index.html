<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-staff/procedures/new-host">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Creating new hosts (servers, desktops) | OCF Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://new.ocf.berkeley.edu/docs/staff/procedures/new-host"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Creating new hosts (servers, desktops) | OCF Docs"><meta data-rh="true" name="description" content="Bringing up new hosts is pretty easy, but has a few easy-to-miss steps. This"><meta data-rh="true" property="og:description" content="Bringing up new hosts is pretty easy, but has a few easy-to-miss steps. This"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://new.ocf.berkeley.edu/docs/staff/procedures/new-host"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/procedures/new-host" hreflang="en"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/procedures/new-host" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.3979abba.css">
<link rel="preload" href="/docs/assets/js/runtime~main.a314d0f9.js" as="script">
<link rel="preload" href="/docs/assets/js/main.4f9c1481.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCF Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocf/ocfstatic/tree/master/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/internal/about/">internal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/services/account/">services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/staff/backend/">staff</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/backend/">Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/getinvolved">Getting Involved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/i3wm">i3wm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/mailing-lists">Staff mailing lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/policies/">Staff policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Staff policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/powers">Staff privileges</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/private">Additional documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staff/procedures/">Procedures</a><button aria-label="Toggle the collapsible sidebar category &#x27;Procedures&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/procedures/accounts/">Accounts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Accounts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/backporting-packages">Backporting Debian packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/dmca">DMCA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/editing-docs">Editing docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/gapps">Making OCF Google Apps accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/granting-privileges">Granting staff privileges</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/hpc">Adding users to the HPC cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/installing-updates">Installing updates with apt-dater</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staff/procedures/new-host">Creating new hosts (servers, desktops)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/printing">Printing maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/process-accounting">Process accounting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/restarting-services">Restarting services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/setting-up-lacp">Setting up bridging and link aggregation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/setting-up-mdraid">Setting up mdraid on servers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/ssh-supernova">SSHing into Supernova</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/ssl">SSL certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/user-quotas">User disk quotas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/vhost">Configuring virtual hosting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/procedures/xmpp">Manually creating XMPP accounts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/rebuild/">Rebuild</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rebuild&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/scripts/">Scripts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scripts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/startertasks/">Starter Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Starter Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/techtalks">Tech talks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/tips/">Tips and tricks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tips and tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">staff</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staff/procedures/"><span itemprop="name">Procedures</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Creating new hosts (servers, desktops)</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Creating new hosts (servers, desktops)</h1></header><p>Bringing up new hosts is pretty easy, but has a few easy-to-miss steps. This
process requires both root and a <code>/admin</code> principal.</p><p>It&#x27;s preferable to not bring up servers at a whim, but if you must, you should
use hostnames of the form <code>hozer-{60..89}</code> and their corresponding IP addresses
(rather than allocating new ones). Please clean up when you&#x27;re finished by
running <code>virsh undefine hozer-{num}</code> to remove the VM and <code>lvremove /dev/vg/hozer-{num}</code> to remove the logical volume.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-0-pick-a-hostname-and-ip">Step 0. Pick a hostname and IP<a class="hash-link" href="#step-0-pick-a-hostname-and-ip" title="Direct link to heading">​</a></h2><p>If you are creating a brand-new host, you can find a list of IP addresses
already in use in our <a href="https://github.com/ocf/dns/blob/master/etc/zones/db.226.229.169.in-addr.arpa" target="_blank" rel="noopener noreferrer">DNS repo on GitHub</a>. Hostnames must be
based on (un)natural disasters; check out <code>~staff/server_name_ideas</code> if you&#x27;re
having trouble thinking of one.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-new-hosts-only-add-to-ldap-dns-puppet-kerberos">Step 1. (New hosts only) Add to LDAP, DNS, Puppet, Kerberos<a class="hash-link" href="#step-1-new-hosts-only-add-to-ldap-dns-puppet-kerberos" title="Direct link to heading">​</a></h2><p>Only do these if a server with this hostname has never existed before (or if
it&#x27;s been long enough that some of these steps have never been done before).
Unfortunately, these steps tend to change a lot as our infrastructure evolves.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-11-add-the-ldap-entry">Step 1.1. Add the LDAP entry<a class="hash-link" href="#step-11-add-the-ldap-entry" title="Direct link to heading">​</a></h3><p>On supernova, <code>kinit $USER/admin ldap-add-host &lt;hostname&gt; &lt;ip&gt;</code>. If setting up
a desktop, also do <code>kinit $USER/admin ldapvi cn=&lt;hostname&gt;</code> and set the <code>type</code>
attribute to <code>desktop</code>. If doing a staff VM, set it to <code>staffvm</code> instead.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-12-add-the-dns-record">Step 1.2. Add the DNS record<a class="hash-link" href="#step-12-add-the-dns-record" title="Direct link to heading">​</a></h3><p>Clone the <a href="https://github.com/ocf/dns" target="_blank" rel="noopener noreferrer">DNS repo</a> from GitHub, run <code>make</code>, and push a commit
with the new records.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-13-add-node-config-to-puppet">Step 1.3. Add node config to Puppet<a class="hash-link" href="#step-13-add-node-config-to-puppet" title="Direct link to heading">​</a></h3><p>Only do this if you are creating a staff VM, a server which will run a service,
or a special snowflake. Make a commit to the <a href="https://github.com/ocf/puppet" target="_blank" rel="noopener noreferrer">Puppet repo</a> which
adds a file <code>hieradata/nodes/&lt;hostname&gt;.yaml</code> for the new host. Follow the
example of a similar node&#x27;s <code>host.yaml</code> file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-14-create-the-kerberos-keytab">Step 1.4. Create the Kerberos keytab<a class="hash-link" href="#step-14-create-the-kerberos-keytab" title="Direct link to heading">​</a></h3><p>On the puppetmaster, run <code>sudo gen-keytab</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-create-the-host-run-debian-installer">Step 2. Create the host, run Debian installer<a class="hash-link" href="#step-2-create-the-host-run-debian-installer" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-hosts">Virtual hosts<a class="hash-link" href="#virtual-hosts" title="Direct link to heading">​</a></h3><p>We have a handy script, <code>makevm</code>, that:</p><ul><li>Creates a logical volume (disk) for the new VM</li><li>Adds a new VM using virt-install and PXE boots it</li><li>Waits for the Debian installer to finish</li><li>SSHs to the new server and sets its IP</li></ul><p>To use it, log on to the target physical server (<code>riptide</code>, <code>hal</code>, <code>pandemic</code>, or <code>jaws</code>),
and run <code>makevm --help</code>. A typical invocation looks something like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">makevm -m 4096 -c 2 -s 15 arsenic 169.229.226.47</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="physical-hosts">Physical hosts<a class="hash-link" href="#physical-hosts" title="Direct link to heading">​</a></h3><p>All you need to do to run the Debian installer is PXE boot. On desktops, you
sometimes need to enable this in the BIOS before you can select it from the
boot menu.</p><p>Be warned that the default action (automated install) happens after 5 seconds.
So don&#x27;t PXE-boot your laptop and walk away!</p><p>We preseed a bunch of settings (random questions, mirror locations, packages,
etc.). The install should be completely hands-free, and will restart to a login
tty.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-log-in-and-start-puppet">Step 3. Log in and start Puppet<a class="hash-link" href="#step-3-log-in-and-start-puppet" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-hosts-1">Virtual hosts<a class="hash-link" href="#virtual-hosts-1" title="Direct link to heading">​</a></h3><p>The <code>makevm</code> script at the very end drops you into a shell. In this shell, you
should run:</p><ol><li><code>puppet agent --test</code>.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="physical-hosts-1">Physical hosts<a class="hash-link" href="#physical-hosts-1" title="Direct link to heading">​</a></h3><ol><li><p>Log in as <code>root:r00tme</code>. You can change the password if you want, but don&#x27;t
have to (Puppet will change it soon anyway).</p></li><li><p>Make sure the IP address and hostname is set correctly. This may have
happened by DHCP if it&#x27;s a desktop, but if not, fix it and restart:</p><ol><li>Edit <code>/etc/hostname</code> so it has the desired hostname instead of
dhcp-<em>whatever</em>.</li><li>Run <code>hostname -F /etc/hostname</code>.</li><li>Find out what the ethernet interface&#x27;s name and current IP address is
by running <code>ip addr</code>. The ethernet interface should be named something
like <code>eno1</code> or <code>enp4s2</code>. (In the following instructions, substitute
<code>eno1</code> with the correct name.)</li><li>Remove the incorrect IP addresses with <code>ip addr del $WRONG_ADDRESS dev eno1</code>.</li><li>Add the correct IP addresses with <code>ip addr add $CORRECT_ADDRESS dev eno1</code>. Make sure that \$CORRECT_ADDRESS includes the netmask.</li></ol></li><li><p><code>puppet agent --test</code></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-sign-the-puppet-cert-and-run-puppet">Step 4. Sign the Puppet cert and run Puppet<a class="hash-link" href="#step-4-sign-the-puppet-cert-and-run-puppet" title="Direct link to heading">​</a></h2><p>On the puppetmaster, <code>sudo puppetserver ca list</code> to see pending requests. When
you see yours, use <code>sudo puppetserver ca sign --certname hostname.ocf.berkeley.edu</code>.</p><p>Log back into the host and run <code>puppet agent --test</code> to start the Puppet
run. You may need to repeat this once or twice until the run converges.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-41-upgrade-packages">Step 4.1. Upgrade packages<a class="hash-link" href="#step-41-upgrade-packages" title="Direct link to heading">​</a></h3><p>The first Puppet run and various other things may be broken if one or more
packages are out of date, e.g. Puppet. Remedy this with an <code>apt update &amp;&amp; apt upgrade</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/procedures/new-host.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/staff/procedures/installing-updates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Installing updates with apt-dater</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/staff/procedures/printing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Printing maintenance</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-0-pick-a-hostname-and-ip" class="table-of-contents__link toc-highlight">Step 0. Pick a hostname and IP</a></li><li><a href="#step-1-new-hosts-only-add-to-ldap-dns-puppet-kerberos" class="table-of-contents__link toc-highlight">Step 1. (New hosts only) Add to LDAP, DNS, Puppet, Kerberos</a><ul><li><a href="#step-11-add-the-ldap-entry" class="table-of-contents__link toc-highlight">Step 1.1. Add the LDAP entry</a></li><li><a href="#step-12-add-the-dns-record" class="table-of-contents__link toc-highlight">Step 1.2. Add the DNS record</a></li><li><a href="#step-13-add-node-config-to-puppet" class="table-of-contents__link toc-highlight">Step 1.3. Add node config to Puppet</a></li><li><a href="#step-14-create-the-kerberos-keytab" class="table-of-contents__link toc-highlight">Step 1.4. Create the Kerberos keytab</a></li></ul></li><li><a href="#step-2-create-the-host-run-debian-installer" class="table-of-contents__link toc-highlight">Step 2. Create the host, run Debian installer</a><ul><li><a href="#virtual-hosts" class="table-of-contents__link toc-highlight">Virtual hosts</a></li><li><a href="#physical-hosts" class="table-of-contents__link toc-highlight">Physical hosts</a></li></ul></li><li><a href="#step-3-log-in-and-start-puppet" class="table-of-contents__link toc-highlight">Step 3. Log in and start Puppet</a><ul><li><a href="#virtual-hosts-1" class="table-of-contents__link toc-highlight">Virtual hosts</a></li><li><a href="#physical-hosts-1" class="table-of-contents__link toc-highlight">Physical hosts</a></li></ul></li><li><a href="#step-4-sign-the-puppet-cert-and-run-puppet" class="table-of-contents__link toc-highlight">Step 4. Sign the Puppet cert and run Puppet</a><ul><li><a href="#step-41-upgrade-packages" class="table-of-contents__link toc-highlight">Step 4.1. Upgrade packages</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Board of Directors of the Open Computing Facility.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.a314d0f9.js"></script>
<script src="/docs/assets/js/main.4f9c1481.js"></script>
</body>
</html>