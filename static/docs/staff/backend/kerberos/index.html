<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-staff/backend/kerberos">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Kerberos | OCF Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://new.ocf.berkeley.edu/docs/staff/backend/kerberos"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kerberos | OCF Docs"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://new.ocf.berkeley.edu/docs/staff/backend/kerberos"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/kerberos" hreflang="en"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/kerberos" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.3979abba.css">
<link rel="preload" href="/docs/assets/js/runtime~main.a314d0f9.js" as="script">
<link rel="preload" href="/docs/assets/js/main.4f9c1481.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCF Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocf/ocfstatic/tree/master/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/internal/about/">internal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/services/account/">services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/staff/backend/">staff</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staff/backend/">Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/backups">Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/firewall">External firewall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/git">Git</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/internal-firewalls">Internal firewalls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/jenkins">Jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staff/backend/kerberos">Kerberos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/libvirt">KVM/Libvirt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/backend/mail/">Mail</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mail&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/munin">Munin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/printhost">Printhost</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/prometheus">Prometheus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/puppet">Puppet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/rt">Request Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/switch">Managed switches</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/getinvolved">Getting Involved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/i3wm">i3wm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/mailing-lists">Staff mailing lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/policies/">Staff policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Staff policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/powers">Staff privileges</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/private">Additional documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/procedures/">Procedures</a><button aria-label="Toggle the collapsible sidebar category &#x27;Procedures&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/rebuild/">Rebuild</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rebuild&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/scripts/">Scripts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scripts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/startertasks/">Starter Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Starter Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/techtalks">Tech talks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/tips/">Tips and tricks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tips and tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">staff</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staff/backend/"><span itemprop="name">Infrastructure</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Kerberos</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kerberos</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>Kerberos is a network authentication system that is designed for client to
server communication over a (potentially) insecure network, where data can be
eavesdropped on, and addresses can be faked. It has several security and
usability advantages over using password-based authentication over the network.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-advantages">Security advantages<a class="hash-link" href="#security-advantages" title="Direct link to heading">​</a></h3><p>One major security advantage of using Kerberos is that if a ticket is stolen
from a host, it will expire, so damage is minimized compared to being able to
steal a password or long-lived ticket. Kerberos also assumes that the network
that is being used for communication could be compromised and has malicious
users who could be listening to network traffic and stealing any data sent from
machine to machine. To combat this, Kerberos does not send any data like
plaintext passwords or keys by themselves across the network that could be used
for attacks. Instead, it uses tickets, and encrypts data sent to clients and
servers with a key that only that machine can read.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="usability-advantages">Usability advantages<a class="hash-link" href="#usability-advantages" title="Direct link to heading">​</a></h3><p>Kerberos makes passwordless login easy, since after the first password is
input, a ticket can be used for future logins instead of having to type the
same password again and go through the whole authentication process a second
time. Keep in mind that all of the authentication will have to be done every 10
hours, as tickets do expire, but passwords have to be typed far less with
Kerberos in place. Tickets are invalidated on logout, so that makes sure that
someone can&#x27;t steal a ticket and use it after you have left, as a little added
security.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="versions">Versions<a class="hash-link" href="#versions" title="Direct link to heading">​</a></h2><p>There are two major free versions of Kerberos: MIT and Heimdal Kerberos. At the
OCF, we use Heimdal Kerberos; if you look up documentation, it might instead
be for the MIT version, so be careful to make sure the commands work. Kerberos
also has 2 main versions that are still used: version 4 and version 5. Version
5 fixes a lot of the security and design flaws of version 4, so we use version
5 of the protocol.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terminology">Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">​</a></h2><p>Unfortunately, Kerberos is a complicated protocol that involves a lot of
technical jargon. Here&#x27;s a bunch of different terms that you might run into
when reading about or working on Kerberos and an attempt to explain what they
mean:</p><ul><li><p><strong>KDC</strong> (<strong>K</strong>ey <strong>D</strong>istribution <strong>C</strong>enter): The central server that issues
tickets for Kerberos communication and stores all users&#x27; keys. If the KDC is
compromised, you are going to have a very bad time and <a href="https://xkcd.com/1133/" target="_blank" rel="noopener noreferrer">will not go to space
today</a>. Our current KDC is firestorm, but that could change in
the future, as servers are moved around or rebuilt.</p></li><li><p><strong>Realm</strong>: A kerberos domain, usually identified with the domain name in all
caps (e.g. <code>OCF.BERKELEY.EDU</code>). Two hosts are in the same realm if they share
some kind of secret (password or key). The default realm is specified in
<code>/etc/krb5.conf</code>, alongside the <a href="https://github.com/ocf/puppet/blob/17bc94b395e254529d97c84fb044f76931439fd7/modules/ocf/files/auth/krb5.conf#L27" target="_blank" rel="noopener noreferrer">location of the KDC and admin server</a> (<code>kerberos.ocf.berkeley.edu</code> in our case). Cross-realm
authentication is possible, but is thankfully not something we need to do, as
it significantly complicates things.</p></li><li><p><strong>Principal</strong>: A Kerberos principal is essentially a name used to refer to an
entry in the Kerberos database. Each principal is associated with a user,
host, or service of a realm. All principals shown below are followed by
<code>@OCF.BERKELEY.EDU</code> since it is the realm the OCF uses.</p><ul><li><p><strong>User</strong>: <code>[user]</code> or <code>[user]/[instance]</code> e.g. <code>jvperrin</code> or
<code>mattmcal/root</code>. Used for user logins or for user privileges such as
editing LDAP or running commands with <code>sudo</code>.</p></li><li><p><strong>Host</strong>: <code>host/[hostname]</code> e.g. <code>host/supernova.ocf.berkeley.edu</code>. Used by
Kerberos to allow clients to verify they are communicating with the correct
host. For instance, when using SSH to connect to a host, that hosts&#x27;s
principal is looked up to make sure that you are connecting to the right
host and that the host is not actually some other malicious host.</p></li><li><p><strong>Service</strong>: <code>[service]/[hostname]</code> e.g. <code>ldap/firestorm.ocf.berkeley.edu</code>.
Used to enable Kerberos authentication with a service running on a
particular host, such as <code>http</code>, which (for instance) enables logins to RT,
or <code>smtp</code>, which allows email authentication.</p></li></ul></li><li><p><strong>Ticket</strong>: Tickets are issued by the TGS (see below) to clients. Tickets
have an expiration time, which is set to the default of 10 hours after being
issued.</p></li><li><p><strong>Keytab</strong>: A keytab is essentially the equivalent of a password, but one
that can be used easily by a script. If someone has read access to a keytab,
they can retrieve all the keys in it, so be very careful what permissions are
set on keytabs.</p></li><li><p><strong>TGT</strong> (<strong>T</strong>icket <strong>G</strong>ranting <strong>T</strong>icket): A special ticket that is used
for communication between the client machine and the KDC.</p></li><li><p><strong>TGS</strong> (<strong>T</strong>icket <strong>G</strong>ranting <strong>S</strong>ervice): Usually the same as the KDC,
the job of the TGS is to grant tickets (see above) for different network
services.</p></li><li><p><strong>GSS-API</strong>: The API used by different applications to be able to
authenticate with Kerberos.</p></li><li><p><strong>SASL</strong>: An authentication layer that many different applications can use.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="commands">Commands<a class="hash-link" href="#commands" title="Direct link to heading">​</a></h2><p>All conveniently prefixed with the letter <code>k</code>.</p><ul><li><p><code>kinit</code>: Used to get a ticket, for instance to be able to edit LDAP, or run
commands that need <code>sudo</code> (using the <code>[user]/root</code> principal). For instance,
to edit your own LDAP entry, run <code>kinit [user]/admin ldapvi uid=[user]</code> to
authenticate using your <code>admin</code> Kerberos principal and then run <code>ldapvi</code>. The
default principal requested is your base user principal (<code>[user]@[realm]</code>).
Any commands put after <code>kinit</code> will be ran as usual with the requested
credentials.</p></li><li><p><code>klist</code>: Shows all current tickets held with issued and expiration datetimes
and the principal that each ticket corresponds to.</p></li><li><p><code>kadmin</code>: Administration utility for Kerberos to make changes to the Kerberos
database, either locally (with <code>-l</code>), or remotely by connecting to the KDC.
Can retrieve information about principals, modify principal attributes,
change principal passwords, show privileges allowed, etc.</p></li><li><p><code>kdestroy</code>: Remove a principal or ticket file. This is essentially the
opposite of <code>kinit</code>, so it invalidates tickets you have, logging you out from
Kerberos. This is automatically run on logout to invalidate any lingering
tickets.</p></li><li><p><code>ktutil</code>: Very useful command that has a variety of subcommands for managing
keytabs. Can be used to list credentials available in a keytab, add keys to a
keytab, remove keys, etc.</p></li><li><p><code>kpasswd</code>: Used to change Kerberos passwords.</p></li><li><p><code>kimpersonate</code>: Used for impersonating another user using their keytab.</p></li></ul><p>There are more commands, but they aren&#x27;t used so often, and can be searched if
needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-privileges-for-users">Adding privileges for users<a class="hash-link" href="#adding-privileges-for-users" title="Direct link to heading">​</a></h2><p>To add privileges for users, first create a new principal for them to use. As
part of this process, the user will have to give each principal a password. The
password can be the same or different from their main user principal, but they
will have to enter it every time they want to edit LDAP or run commands with
<code>sudo</code>. To create a new principal, run <code>kadmin add [user]/[instance]</code>, where
<code>[instance]</code> is either <code>root</code> or <code>admin</code>. The <code>[user]/root</code> principal is used
when running <code>sudo</code> commands and for changing user passwords, whereas the
<code>[user]/admin</code> principal is used mainly for modifying LDAP.</p><p>Next, to give the principal actual privileges, add the principals and
privileges assigned to the <a href="https://github.com/ocf/puppet/blob/master/modules/ocf_kerberos/files/kadmind.acl" target="_blank" rel="noopener noreferrer">kadmind.acl file</a> used by Puppet. Notice that
the <code>all</code> privilege does not actually give <em>all</em> privileges, since the
<code>get-keys</code> privilege is separate. The <code>get-keys</code> privilege is used to fetch
principals&#x27; keys, which is equivalent to knowing the password hash in other
authentication systems, so it is not a privilege to be handed out lightly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-it-actually-work">How does it actually work?<a class="hash-link" href="#how-does-it-actually-work" title="Direct link to heading">​</a></h2><p>Kerberos is pretty complicated, so explaining exactly how it works gets messy
very quickly, but here are the main steps that are taken by Kerberos when a
user logs in to their machine. A great guide on these steps is <a href="https://www.roguelynn.com/words/explain-like-im-5-kerberos/" target="_blank" rel="noopener noreferrer">Lynn Root&#x27;s
<em>Explain it like I&#x27;m 5: Kerberos</em></a>, and explains it better and in more
depth than the rather cursory overview found here:</p><ol><li><p>The user enters their username. Their login is sent to the KDC to receieve a
ticket.</p></li><li><p>The KDC checks in its database for a principal that matches the one sent by
the client. If one is found, it returns a TGT, which is encrypted with the
user&#x27;s key (originally generated from the user&#x27;s password and stored on the
KDC).</p></li><li><p>The client gets the encrypted TGT and decrypts it with the user&#x27;s entered
password. Note the user&#x27;s password was never directly sent across the
network at any stage in the process. Then the TGT is stored in the cache on
the client machine until it expires, when it is requested again if needed.</p></li><li><p>The user can then use this TGT to make requests for service tickets from the
KDC.</p></li></ol><p>Kerberos makes sure that nobody can request a TGT for a user except the user
themselves by using preauthentication, which essentially means that the KDC
requests additional authentication than just a principal to give a TGT, since
otherwise the key in the TGT could just be cracked offline by an attacker using
a dictionary attack. This preauthentication typically takes the form of
something like the current time encrypted with the user&#x27;s key. If an attacker
intercepts this communication, they do not have the exact timestamp or the
user&#x27;s key to attempt to decrypt it. We require pre-authentication at the OCF
by specifying <code>require-preauth = true</code> in <a href="https://github.com/ocf/puppet/blob/17bc94b395e254529d97c84fb044f76931439fd7/modules/ocf_kerberos/files/kdc.conf#L13" target="_blank" rel="noopener noreferrer">/var/lib/heimdal-kdc/kdc.conf</a>.</p><p>Then, if the user wants to communicate with other services or hosts, like SSH
or a HTTP Kerberos login, then they make more requests to the KDC:</p><ol><li><p>The client will request a service or host principal from the TGS (Ticket
Granting Service) using the TGT received before. The TGS in our case is the
same as the KDC, but for some systems they could be different hosts. The TGS
sends in response a service ticket, which the client then stores for use in
contacting a service and authenticating until the service ticket expires.</p></li><li><p>The client can then use this service ticket to send with requests to
Kerberos-enabled services, like SSH, as user authentication. The service
will verify the ticket with the KDC when used, to make sure it is valid for
the user issuing the request.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/backend/kerberos.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/staff/backend/jenkins"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Jenkins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/staff/backend/kubernetes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubernetes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#security-advantages" class="table-of-contents__link toc-highlight">Security advantages</a></li><li><a href="#usability-advantages" class="table-of-contents__link toc-highlight">Usability advantages</a></li></ul></li><li><a href="#versions" class="table-of-contents__link toc-highlight">Versions</a></li><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a></li><li><a href="#commands" class="table-of-contents__link toc-highlight">Commands</a></li><li><a href="#adding-privileges-for-users" class="table-of-contents__link toc-highlight">Adding privileges for users</a></li><li><a href="#how-does-it-actually-work" class="table-of-contents__link toc-highlight">How does it actually work?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Board of Directors of the Open Computing Facility.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.a314d0f9.js"></script>
<script src="/docs/assets/js/main.4f9c1481.js"></script>
</body>
</html>