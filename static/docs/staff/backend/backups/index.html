<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-staff/backend/backups">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Backups | OCF Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://new.ocf.berkeley.edu/docs/staff/backend/backups"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backups | OCF Docs"><meta data-rh="true" name="description" content="Backup Storage"><meta data-rh="true" property="og:description" content="Backup Storage"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://new.ocf.berkeley.edu/docs/staff/backend/backups"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/backups" hreflang="en"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/backups" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.3979abba.css">
<link rel="preload" href="/docs/assets/js/runtime~main.a314d0f9.js" as="script">
<link rel="preload" href="/docs/assets/js/main.4f9c1481.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCF Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocf/ocfstatic/tree/master/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/internal/about/">internal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/services/account/">services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/staff/backend/">staff</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staff/backend/">Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staff/backend/backups">Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/firewall">External firewall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/git">Git</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/internal-firewalls">Internal firewalls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/jenkins">Jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/kerberos">Kerberos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/libvirt">KVM/Libvirt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/backend/mail/">Mail</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mail&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/munin">Munin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/printhost">Printhost</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/prometheus">Prometheus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/puppet">Puppet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/rt">Request Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/switch">Managed switches</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/getinvolved">Getting Involved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/i3wm">i3wm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/mailing-lists">Staff mailing lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/policies/">Staff policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Staff policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/powers">Staff privileges</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/private">Additional documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/procedures/">Procedures</a><button aria-label="Toggle the collapsible sidebar category &#x27;Procedures&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/rebuild/">Rebuild</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rebuild&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/scripts/">Scripts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scripts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/startertasks/">Starter Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Starter Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/techtalks">Tech talks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/tips/">Tips and tricks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tips and tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">staff</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staff/backend/"><span itemprop="name">Infrastructure</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Backups</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Backups</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup-storage">Backup Storage<a class="hash-link" href="#backup-storage" title="Direct link to heading">​</a></h2><p>We currently store our on-site backups across a couple drives on <code>hal</code>:</p><ul><li><p><code>hal:/opt/backups</code> (6 TiB usable; 2x 6-TiB Seagate drives in RAID 1 in an LVM
volume group)</p><p>This volume group provides <code>/dev/vg-backups/backups-live</code> which contains
recent daily, weekly, and monthly backups, and
<code>/dev/vg-backups/backups-scratch</code>, which is scratch space for holding
compressed and encrypted backups which we then upload to off-site storage.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="off-site-backups">Off-Site Backups<a class="hash-link" href="#off-site-backups" title="Direct link to heading">​</a></h2><p>Our main off-site backup location is <a href="https://www.box.com" target="_blank" rel="noopener noreferrer">Box</a>. Students automatically get an
&quot;unlimited&quot; plan, so it provides a nice and free location to store encrypted
backups. We currently have a weekly cronjob that <a href="https://github.com/ocf/puppet/blob/master/modules/ocf_backups/files/create-encrypted-backup" target="_blank" rel="noopener noreferrer">makes an encrypted
backup</a> using GPG keys and then <a href="https://github.com/ocf/puppet/blob/master/modules/ocf_backups/files/upload-to-box" target="_blank" rel="noopener noreferrer">uploads it to
Box.com</a>. This takes about 20 hours combined to make and upload,
and will probably take even longer in the future as backups grow. An email is
sent out once the backup files are uploaded, and the link provided is shared
with only OCF officers to make sure the backups are kept as secure as possible,
since they contain all of the OCF&#x27;s important data. The backups are already
encrypted, but it doesn&#x27;t hurt to add a little extra security to that.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retention">Retention<a class="hash-link" href="#retention" title="Direct link to heading">​</a></h3><p>Off-site backups older than six months (180 days) are permanently deleted by a
<a href="https://github.com/ocf/puppet/blob/master/modules/ocf_backups/files/prune-old-backups" target="_blank" rel="noopener noreferrer">daily cronjob</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="restoring-backups">Restoring Backups<a class="hash-link" href="#restoring-backups" title="Direct link to heading">​</a></h2><p>The easiest way to restore from a backup is to look at how it is made and
reverse it. If it is a directory specified in rsnapshot, then likely all that
needs to be done is to take that directory from the backup and put it onto the
server to restore onto. Some backups, such as mysql, ldap, and kerberos are
more complicated, and need to be restored using <code>mysqlimport</code> or <code>ldapadd</code> for
instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="onsite">Onsite<a class="hash-link" href="#onsite" title="Direct link to heading">​</a></h3><p>Onsite backups are pretty simple, all that needs to be done is to go to <code>hal</code>
and find the backup to restore from in <code>/opt/backups/live</code>. All backups of
recent data are found in either <code>rsnapshot</code> (for daily backups) or <code>misc</code> (for
any incidents or one-off backups). Within <code>rsnapshot</code>, the backups are
organized into directories dependings on how long ago the backup was made. To
see when each backup was created just use <code>ls -l</code> to show the last modified
time of each directory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="offsite">Offsite<a class="hash-link" href="#offsite" title="Direct link to heading">​</a></h3><p>Offsite backups are more complicated because the backup files first need to be
downloaded, stuck together into a single file, decrypted, extracted, and then
put into LVM to get back the whole backup archive that would normally be found
onsite. This essentially just means that the
<a href="https://github.com/ocf/puppet/blob/master/modules/ocf_backups/files/create-encrypted-backup" target="_blank" rel="noopener noreferrer">create-encrypted-backup</a> script needs to be reversed
to restore once the backup files are downloaded. Here are the general steps to
take to restore from an offsite backup:</p><ol><li><p>Download all the backup pieces from Box.com. This is generally easiest with
a command line tool like <code>cadaver</code>, which can just use a <code>mget *</code> to download
all the files (albeit sequentially). If more speed is needed, open multiple
<code>cadaver</code> connections and download multiple groups of files at once.</p></li><li><p>Put together all the backup pieces into a single file. This can be done by
running <code>cat &lt;backup&gt;.img.gz.gpg.part* &gt; &lt;backup&gt;.img.gz.gpg</code>.</p></li><li><p>Decrypt the backup using <code>gpg</code>. This requires your key pair to be imported
into <code>gpg</code> first using <code>gpg --import public_key.gpg</code> and
<code>gpg --allow-secret-key-import --import private_key.gpg</code>, then you can
decrypt the backup with
<code>gpg --output &lt;backup&gt;.img.gz --decrypt &lt;backup&gt;.img.gz.gpg</code>. Be careful to
keep your private key secure by setting good permissions on it so that nobody
else can read it, and delete it after the backup is imported. The keys can be
deleted with <code>gpg --delete-secret-keys &quot;&lt;Name&gt;&quot;</code> and
<code>gpg --delete-key &quot;&lt;Name&gt;&quot;</code>, where your name is whatever name it shows when
you run <code>gpg --list-keys</code>.</p></li><li><p>Extract the backup with <code>gunzip &lt;backup&gt;.img.gz</code>.</p></li><li><p>Put the backup image into a LVM logical volume. First find the size that the
volume should be by running <code>ls -l &lt;backup&gt;.img</code>, and copy the number of
bytes that outputs. Then create the LV with
<code>sudo lvcreate -L &lt;bytes&gt;B -n &lt;name&gt; /dev/&lt;volume group&gt;</code> where the volume
group has enough space to store the entire backup (2+ TiB).</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup-contents">Backup Contents<a class="hash-link" href="#backup-contents" title="Direct link to heading">​</a></h2><p>Backups currently include:</p><ul><li>Everything on NFS<ul><li>User home and web directories</li><li>Cronjobs on supported servers (tsunami, supernova, biohazard, etc.)</li></ul></li><li>MySQL databases (including user databases, stats, RT, print quotas, IRC data)</li><li>Everything on GitHub (probably very unnecessary)</li><li>LDAP and Kerberos data</li><li>A <a href="https://github.com/ocf/puppet/blob/17bc94b395e254529d97c84fb044f76931439fd7/modules/ocf_backups/files/rsnapshot.conf#L53" target="_blank" rel="noopener noreferrer">smattering of random files on random servers</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup-procedures">Backup Procedures<a class="hash-link" href="#backup-procedures" title="Direct link to heading">​</a></h2><p>Backups are currently made daily via a cronjob on <code>hal</code> which calls <code>rsnapshot</code>.
The current settings are to retain 7 daily backups, 4 weekly backups, and 6
monthly backups, but we might adjust this as it takes more space or we get
larger backup drives.</p><p>We use <code>rsnapshot</code> to make incremental backups. Typically, each new backup
takes an additional ~3GiB of space (but this will vary based on how many files
actually changed). A full backup is about ~2TiB of space and growing.</p><p>(The incremental file backups are only about ~300 MiB, but since mysqldump
files can&#x27;t be incrementally backed up, those take a whole ~2 GiB each time, so
the total backup grows by ~3GiB each time. However, an old backup is discarded
each time too, so it approximately breaks even.)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ideas-for-backup-improvements">Ideas for backup improvements<a class="hash-link" href="#ideas-for-backup-improvements" title="Direct link to heading">​</a></h2><ol><li>Automate backup testing, so have some system for periodically checking that
backups can be restored from, whether they are offsite or onsite.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/backend/backups.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/staff/backend/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Infrastructure</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/staff/backend/firewall"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">External firewall</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#backup-storage" class="table-of-contents__link toc-highlight">Backup Storage</a></li><li><a href="#off-site-backups" class="table-of-contents__link toc-highlight">Off-Site Backups</a><ul><li><a href="#retention" class="table-of-contents__link toc-highlight">Retention</a></li></ul></li><li><a href="#restoring-backups" class="table-of-contents__link toc-highlight">Restoring Backups</a><ul><li><a href="#onsite" class="table-of-contents__link toc-highlight">Onsite</a></li><li><a href="#offsite" class="table-of-contents__link toc-highlight">Offsite</a></li></ul></li><li><a href="#backup-contents" class="table-of-contents__link toc-highlight">Backup Contents</a></li><li><a href="#backup-procedures" class="table-of-contents__link toc-highlight">Backup Procedures</a></li><li><a href="#ideas-for-backup-improvements" class="table-of-contents__link toc-highlight">Ideas for backup improvements</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Board of Directors of the Open Computing Facility.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.a314d0f9.js"></script>
<script src="/docs/assets/js/main.4f9c1481.js"></script>
</body>
</html>