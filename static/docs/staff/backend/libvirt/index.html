<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-staff/backend/libvirt">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">KVM/Libvirt | OCF Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://new.ocf.berkeley.edu/docs/staff/backend/libvirt"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="KVM/Libvirt | OCF Docs"><meta data-rh="true" name="description" content="Most of the OCF&#x27;s hosts are virtual machines. Our virtual machines are all"><meta data-rh="true" property="og:description" content="Most of the OCF&#x27;s hosts are virtual machines. Our virtual machines are all"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://new.ocf.berkeley.edu/docs/staff/backend/libvirt"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/libvirt" hreflang="en"><link data-rh="true" rel="alternate" href="https://new.ocf.berkeley.edu/docs/staff/backend/libvirt" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.3979abba.css">
<link rel="preload" href="/docs/assets/js/runtime~main.a314d0f9.js" as="script">
<link rel="preload" href="/docs/assets/js/main.4f9c1481.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCF Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocf/ocfstatic/tree/master/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/internal/about/">internal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/services/account/">services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/staff/backend/">staff</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staff/backend/">Infrastructure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Infrastructure&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/backups">Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/firewall">External firewall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/git">Git</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/internal-firewalls">Internal firewalls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/jenkins">Jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/kerberos">Kerberos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/kubernetes">Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staff/backend/libvirt">KVM/Libvirt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/backend/mail/">Mail</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mail&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/munin">Munin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/printhost">Printhost</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/prometheus">Prometheus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/puppet">Puppet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/rt">Request Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/backend/switch">Managed switches</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/getinvolved">Getting Involved</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/i3wm">i3wm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/mailing-lists">Staff mailing lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/policies/">Staff policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Staff policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/powers">Staff privileges</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/private">Additional documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/procedures/">Procedures</a><button aria-label="Toggle the collapsible sidebar category &#x27;Procedures&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/rebuild/">Rebuild</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rebuild&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/scripts/">Scripts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scripts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/startertasks/">Starter Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Starter Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staff/techtalks">Tech talks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staff/tips/">Tips and tricks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tips and tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">staff</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staff/backend/"><span itemprop="name">Infrastructure</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">KVM/Libvirt</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>KVM/Libvirt</h1></header><p>Most of the OCF&#x27;s hosts are virtual machines. Our virtual machines are all
powered by <a href="https://www.qemu.org/" target="_blank" rel="noopener noreferrer">QEMU</a>/<a href="https://www.linux-kvm.org/" target="_blank" rel="noopener noreferrer">KVM</a> and managed by <a href="https://libvirt.org/" target="_blank" rel="noopener noreferrer">libvirt</a> on the
hypervisors.</p><p>VM disks are stored as LVM volumes on the hypervisors, typically under
<code>/dev/vg/&lt;vm-name&gt;</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="administration">Administration<a class="hash-link" href="#administration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-view-which-vms-are-on-a-hypervisor">How do I view which VMs are on a hypervisor?<a class="hash-link" href="#how-do-i-view-which-vms-are-on-a-hypervisor" title="Direct link to heading">​</a></h3><p>SSH into the hypervisor, then run <code>sudo virsh list --all</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpengboy@hal:~$ sudo virsh list --all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Id    Name                           State</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1     fallingrocks                   running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 3     limniceruption                 running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 4     spriggs                        running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 5     dev-flood                      running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 11    dev-whiteout                   running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 15    dev-death                      running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 18    dev-tsunami                    running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -     dev-anthrax                    shut off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -     dev-pestilence                 shut off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -     dev-werewolves                 shut off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -     zombies                        shut off</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-turn-on-a-vm">How do I turn on a VM?<a class="hash-link" href="#how-do-i-turn-on-a-vm" title="Direct link to heading">​</a></h3><p>On the hypervisor, run <code>sudo virsh start &lt;vm-name&gt;</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-turn-off-a-vm">How do I turn off a VM?<a class="hash-link" href="#how-do-i-turn-off-a-vm" title="Direct link to heading">​</a></h3><p>You can SSH into the VM and run the <code>shutdown</code> command, or you can run
<code>sudo virsh shutdown &lt;vm-name&gt;</code> on the hypervisor which hosts it.</p><p>If it&#x27;s a public-facing VM (e.g. tsunami), remember to give a positive amount
of time to the shutdown command, so users have adequate warning.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-make-a-vm-automatically-turn-on-when-the-hypervisor-boots">How do I make a VM automatically turn on when the hypervisor boots?<a class="hash-link" href="#how-do-i-make-a-vm-automatically-turn-on-when-the-hypervisor-boots" title="Direct link to heading">​</a></h3><p>On the hypervisor, run <code>sudo virsh autostart &lt;vm-name&gt;</code>.</p><p>You can list which VMs are set to autostart with <code>sudo virsh list --all --autostart</code>.</p><p>Firestorm is set to autostart because it must be running in order for any staff
to log in (other than by using the root account). Other VMs are not set to
autostart because if they start before LDAP and Kerberos are available, logins
may not necessarily work properly.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="is-there-a-gui-for-all-of-this">Is there a GUI for all of this?<a class="hash-link" href="#is-there-a-gui-for-all-of-this" title="Direct link to heading">​</a></h3><p>You can run virt-manager on the hypervisors to graphically start and stop VMs,
view their virtual monitors, and do many other similar things. To access
virt-manager, SSH into the hypervisor with X forwarding (<code>-X</code>) enabled. Then, on
the hypervisor, run <code>sudo XAUTHORITY=~/.Xauthority virt-manager</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="if-you-just-want-to-see-a-single-vms-virtual-monitor">If you just want to see a single VM&#x27;s virtual monitor<a class="hash-link" href="#if-you-just-want-to-see-a-single-vms-virtual-monitor" title="Direct link to heading">​</a></h4><p>You can use the virt-viewer tool. Replace <code>virt-manager</code> in the above command
with <code>virt-viewer &lt;vm-name&gt;</code>.</p><p>Alternatively, you can directly connect to the VM&#x27;s VNC display. This procedure
gives much better performance than X forwarding, especially outside of the OCF
network. To do this, first run <code>sudo virsh vncdisplay &lt;vm-name&gt;</code> on the
hypervisor, and record what it prints out. Then, from your local computer, run
<code>vncviewer -via &lt;hypervisor&gt; &lt;output of virsh vncdisplay&gt;</code>. So for instance, if
<code>virsh vncdisplay</code> printed out <code>127.0.0.1:10</code>, and the hypervisor were jaws,
then you would run <code>vncviewer -via jaws 127.0.0.1:10</code> (or <code>localhost:10</code>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-create-a-vm">How do I create a VM?<a class="hash-link" href="#how-do-i-create-a-vm" title="Direct link to heading">​</a></h3><p>See <a href="/docs/staff/procedures/new-host">Creating new hosts</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-delete-a-vm">How do I delete a VM?<a class="hash-link" href="#how-do-i-delete-a-vm" title="Direct link to heading">​</a></h3><p>On the hypervisor:</p><ol><li>Shutdown the VM.</li><li>Run <code>sudo virsh undefine &lt;vm-name&gt;</code>.</li><li>Backup the VM&#x27;s disk (e.g. by renaming the LVM volume to <code>vg/&lt;vm-name&gt;.old</code>)
or delete it. You may want to also dump the contents of the disk to a file,
compressing it, and placing that file in <code>/opt/backups/live/misc/servers</code> on
the server which contains backups (which is <code>hal</code> at the time of this
writing). You may also want to save the VM&#x27;s XML definition by running
<code>sudo virsh dumpxml [vm-name] &gt; [vm-name].xml</code> and placing it in the same
aforementioned directory.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-move-a-vm-from-one-host-to-another">How do I move a VM from one host to another?<a class="hash-link" href="#how-do-i-move-a-vm-from-one-host-to-another" title="Direct link to heading">​</a></h3><p>Use the <a href="/docs/staff/scripts/migrate-vm">migrate-vm</a> script.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oh-no-ive-got-a-vm-with-broken-networking-how-can-i-access-it">Oh no, I&#x27;ve got a VM with broken networking. How can I access it?<a class="hash-link" href="#oh-no-ive-got-a-vm-with-broken-networking-how-can-i-access-it" title="Direct link to heading">​</a></h3><p>You can open virt-manager as described above, open the VM&#x27;s display, and then
log in there.</p><p>Alternatively, if you don&#x27;t want to bother with opening up a GUI, you can often
access the VM using its serial console. Run <code>sudo virsh console &lt;vm-name&gt;</code> on
the hypervisor. This will connect you to the VM&#x27;s TTY listening on its simulated
serial port.</p><p>You may have to initially hit enter for the VM to (re-)print the login prompt.
When you&#x27;re done, make sure to log out. Then use Ctrl+] to exit the virsh
console.</p><p>This method of accessing the VM only works when there is a getty process
listening on the serial port. All of our VMs start such a process automatically,
but only after boot has mostly finished. Therefore, the serial console probably
won&#x27;t work if you&#x27;re trying to diagnose boot problems.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-edit-my-vms-ram-size-or-cpu-count">How do I edit my VM&#x27;s RAM size or CPU count?<a class="hash-link" href="#how-do-i-edit-my-vms-ram-size-or-cpu-count" title="Direct link to heading">​</a></h3><p>On the hypervisor, run <code>sudo virsh edit &lt;vm-name&gt;</code> to edit the VM&#x27;s XML
definition.</p><p>To query and modify virtual hardware state for your vm, use the following commands,
for RAM:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">virsh dommemstat &lt;vm-name&gt; [[--config] [--live] | [--current]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh setmaxmem &lt;vm-name&gt; &lt;size&gt; [[--config] [--live] | [--current]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh memtune &lt;vm-name&gt; [...]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and for vCPUs:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">virsh vcpuinfo &lt;vm-name&gt; [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh vcpucount &lt;vm-name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh setvcpus &lt;vm-name&gt; &lt;count&gt; [...] [--guest] [--hotpluggable]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-edit-my-vms-disk-size">How do I edit my VM&#x27;s disk size?<a class="hash-link" href="#how-do-i-edit-my-vms-disk-size" title="Direct link to heading">​</a></h3><p>Find the lvm vg</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">virsh dumpxml &lt;vm&gt; | grep -C3 path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the hypervisor,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">virsh dominfo &lt;vm&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh domblkinfo &lt;vm&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvextend /dev/vg/&lt;vm&gt; -L20G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virsh blockresize &lt;vm&gt; /dev/vg/&lt;vm&gt; 20G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the vm,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fdisk /dev/vda        # if needed, very carefully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">partprobe /dev/vda1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resize2fs /dev/vda1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;d like to shrink a partition on-line, see <a href="https://unix.stackexchange.com/questions/226872/how-to-shrink-root-filesystem-without-booting-a-livecd#227318" target="_blank" rel="noopener noreferrer">Unix SE</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/backend/libvirt.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/staff/backend/ldap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">LDAP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/staff/backend/mail/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mail</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#administration" class="table-of-contents__link toc-highlight">Administration</a><ul><li><a href="#how-do-i-view-which-vms-are-on-a-hypervisor" class="table-of-contents__link toc-highlight">How do I view which VMs are on a hypervisor?</a></li><li><a href="#how-do-i-turn-on-a-vm" class="table-of-contents__link toc-highlight">How do I turn on a VM?</a></li><li><a href="#how-do-i-turn-off-a-vm" class="table-of-contents__link toc-highlight">How do I turn off a VM?</a></li><li><a href="#how-do-i-make-a-vm-automatically-turn-on-when-the-hypervisor-boots" class="table-of-contents__link toc-highlight">How do I make a VM automatically turn on when the hypervisor boots?</a></li><li><a href="#is-there-a-gui-for-all-of-this" class="table-of-contents__link toc-highlight">Is there a GUI for all of this?</a></li><li><a href="#how-do-i-create-a-vm" class="table-of-contents__link toc-highlight">How do I create a VM?</a></li><li><a href="#how-do-i-delete-a-vm" class="table-of-contents__link toc-highlight">How do I delete a VM?</a></li><li><a href="#how-do-i-move-a-vm-from-one-host-to-another" class="table-of-contents__link toc-highlight">How do I move a VM from one host to another?</a></li><li><a href="#oh-no-ive-got-a-vm-with-broken-networking-how-can-i-access-it" class="table-of-contents__link toc-highlight">Oh no, I&#39;ve got a VM with broken networking. How can I access it?</a></li><li><a href="#how-do-i-edit-my-vms-ram-size-or-cpu-count" class="table-of-contents__link toc-highlight">How do I edit my VM&#39;s RAM size or CPU count?</a></li><li><a href="#how-do-i-edit-my-vms-disk-size" class="table-of-contents__link toc-highlight">How do I edit my VM&#39;s disk size?</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Board of Directors of the Open Computing Facility.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.a314d0f9.js"></script>
<script src="/docs/assets/js/main.4f9c1481.js"></script>
</body>
</html>