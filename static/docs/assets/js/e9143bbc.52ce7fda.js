"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3590],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>f});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=a.createContext({}),l=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},u=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=l(r),f=n,m=c["".concat(p,".").concat(f)]||c[f]||d[f]||o;return r?a.createElement(m,s(s({ref:t},u),{},{components:r})):a.createElement(m,s({ref:t},u))}));function f(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,s=new Array(o);s[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var l=2;l<o;l++)s[l]=r[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},1676:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=r(7462),n=(r(7294),r(3905));const o={title:"Installing updates with apt-dater"},s=void 0,i={unversionedId:"staff/procedures/installing-updates",id:"staff/procedures/installing-updates",title:"Installing updates with apt-dater",description:"Installing updates requires root (ocfroot group). Besides that, anybody",source:"@site/docs/staff/procedures/installing-updates.md",sourceDirName:"staff/procedures",slug:"/staff/procedures/installing-updates",permalink:"/docs/staff/procedures/installing-updates",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/procedures/installing-updates.md",tags:[],version:"current",frontMatter:{title:"Installing updates with apt-dater"},sidebar:"tutorialSidebar",previous:{title:"Adding users to the HPC cluster",permalink:"/docs/staff/procedures/hpc"},next:{title:"Creating new hosts (servers, desktops)",permalink:"/docs/staff/procedures/new-host"}},p={},l=[{value:"apt-dater",id:"apt-dater",level:2}],u={toc:l};function d(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Installing updates requires root (",(0,n.kt)("inlineCode",{parentName:"p"},"ocfroot")," group). Besides that, anybody\nshould feel free to install updates at any time. Generally it is quite safe,\nthough you might want to keep an eye on important things to ensure they start\nagain after being updated (MySQL, LDAP, and Kerberos are the common offenders)."),(0,n.kt)("h2",{id:"apt-dater"},"apt-dater"),(0,n.kt)("p",null,"We install updates using ",(0,n.kt)("a",{parentName:"p",href:"https://www.ibh.de/apt-dater/"},"apt-dater"),". We wrap it\nin a script that builds a list of hosts from LDAP and sends a summary email to\nroot."),(0,n.kt)("p",null,"To install updates:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Make sure the desktops are not\n",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ocf/puppet/blob/master/modules/ocf_desktop/files/suspend/ocf-suspend"},"suspended"),",\nand that you aren't trying to install updates near a 15-minute boundary when\nthe desktops auto-suspend. See ",(0,n.kt)("a",{parentName:"p",href:"/docs/staff/scripts/lab-wakeup"},"lab-wakeup")," to\nwake up the desktops prior to updating.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"From ",(0,n.kt)("inlineCode",{parentName:"p"},"supernova"),", run:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre"},"sudo apt-dater-ocf\n")),(0,n.kt)("p",{parentName:"li"},"This will send an email to ",(0,n.kt)("inlineCode",{parentName:"p"},"root")," with a list of packages to be updated.\nGlance over the list to make sure there are no obvious problems (for\nexample, if it's trying to upgrade an entire system or install every\navailable backport, which has actually happened before)."),(0,n.kt)("p",{parentName:"li"},"Once apt-dater opens, proceed to the next step.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'Select the "Updates pending" row at the top, and hit ',(0,n.kt)("inlineCode",{parentName:"p"},"u"),". You'll be asked if\nyou wish to upgrade the entire group. Press ",(0,n.kt)("inlineCode",{parentName:"p"},"y")," to confirm.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'All the hosts will now be in the "Sessions" category. Expand it (select then\nhit enter), then attach to each host one-by-one (hit ',(0,n.kt)("inlineCode",{parentName:"p"},"a")," when you're over a\nhost). You'll attach to a tmux session where the updates are being\ninstalled."),(0,n.kt)("p",{parentName:"li"},"In each session, wait for the updates to be installed, then press ",(0,n.kt)("inlineCode",{parentName:"p"},"C-b q"),'.\nIf "errors" are found, you\'ll be asked to review them before proceeding.'),(0,n.kt)("p",{parentName:"li"},"These are full tmux sessions, so you can, for example, use ",(0,n.kt)("inlineCode",{parentName:"p"},"Ctrl-B, D")," to\ndetach if your current session is taking a while."))))}d.isMDXComponent=!0}}]);