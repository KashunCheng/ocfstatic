"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2054],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,g=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7252:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={title:"Django"},i=void 0,p={unversionedId:"services/web/django",id:"services/web/django",title:"Django",description:"Note: These instructions are primarily intended for individual user accounts.",source:"@site/docs/services/web/django.md",sourceDirName:"services/web",slug:"/services/web/django",permalink:"/docs/services/web/django",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/web/django.md",tags:[],version:"current",frontMatter:{title:"Django"},sidebar:"tutorialSidebar",previous:{title:"Backups/Archiving",permalink:"/docs/services/web/backups"},next:{title:"Flask",permalink:"/docs/services/web/flask"}},l={},s=[{value:"Running a Django app",id:"running-a-django-app",level:2},{value:"Making assets available",id:"making-assets-available",level:3},{value:"Debugging",id:"debugging",level:3}],u={toc:s};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note: These instructions are primarily intended for individual user accounts.\nIf you are using a group account, you may wish to consider\n",(0,r.kt)("a",{parentName:"strong",href:"/docs/services/webapps"},"apphosting")," instead.")),(0,r.kt)("p",null,"Django is a popular web framework for Python applications. At the OCF, you can\nhost it using our regular web hosting, though for groups with virtual hosting,\nwe strongly recommend instead using our ",(0,r.kt)("a",{parentName:"p",href:"/docs/services/webapps"},"application hosting service")," instead, as it provides a first-class solution for webapps."),(0,r.kt)("h2",{id:"running-a-django-app"},"Running a Django app"),(0,r.kt)("p",null,"The steps below assume you have already created a Django application. If you\nhaven't, take a look at ",(0,r.kt)("a",{parentName:"p",href:"https://docs.djangoproject.com/en/1.11/intro/tutorial01/"},"the Django documentation")," for help with\nthat."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy your Django application to your OCF account. For example, you can use\n",(0,r.kt)("inlineCode",{parentName:"p"},"scp")," to upload it, or if you're using source control, clone it using ",(0,r.kt)("inlineCode",{parentName:"p"},"git"),"\n(or another tool) into your home directory."),(0,r.kt)("p",{parentName:"li"},"In the steps below, we'll assume you put it at ",(0,r.kt)("inlineCode",{parentName:"p"},"~/app")," in your home\ndirectory.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Inside your project directory, create a virtualenv and install your\ndependencies. For example, to create a Python 3 virtualenv, try:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"user@tsunami:~/app$ virtualenv -p python3 venv\nuser@tsunami:~/app$ venv/bin/pip install django\n")),(0,r.kt)("p",{parentName:"li"},"You'll want to install at least ",(0,r.kt)("inlineCode",{parentName:"p"},"django")," to start with. If you're using\nother packages, install those too. You can also install from a\n",(0,r.kt)("inlineCode",{parentName:"p"},"requirements.txt")," file, if you have one."),(0,r.kt)("p",{parentName:"li"},"For full details on how to use pip, see ",(0,r.kt)("a",{parentName:"p",href:"https://packaging.python.org/tutorials/installing-packages/#installing-from-pypi"},"the pip documentation"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Inside that same virtualenv, install the ",(0,r.kt)("inlineCode",{parentName:"p"},"flup6")," package. You can just\ncopy-and-paste the below snippet:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"user@tsunami:~/app$ venv/bin/pip install flup6\n")),(0,r.kt)("p",{parentName:"li"},"If you're using a ",(0,r.kt)("inlineCode",{parentName:"p"},"requirements.txt")," file, you might want to add it there as\nwell. This part varies by how you're organizing your project.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make a directory under ",(0,r.kt)("inlineCode",{parentName:"p"},"public_html")," to house your application. For example,\n",(0,r.kt)("inlineCode",{parentName:"p"},"~/public_html/django"),". You can also just use ",(0,r.kt)("inlineCode",{parentName:"p"},"public_html")," directly if\ndesired.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the directory you just created, make a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"run.fcgi")," with the file contents:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"#!/home/u/us/user/app/venv/bin/python\nimport os\nimport sys\n\nsys.path.insert(0, os.path.expanduser('~/app'))\nfrom flup.server.fcgi import WSGIServer\n\n  # Replace \"djangoapp\" below with your application name\nfrom djangoapp import wsgi\nif __name__ == '__main__':\n    WSGIServer(wsgi.application).run()\n")),(0,r.kt)("p",{parentName:"li"},"Make sure to replace the first line of ",(0,r.kt)("inlineCode",{parentName:"p"},"run.fcgi")," file with the actual path\nto your project's virtualenv Python. You can find it by running the command\n",(0,r.kt)("inlineCode",{parentName:"p"},"readlink -f ~/app/venv/bin/python"),"."),(0,r.kt)("p",{parentName:"li"},"Make sure also to replace ",(0,r.kt)("inlineCode",{parentName:"p"},"from djangoapp")," with the name of your Django\napplication (that's the name of the directory containing your ",(0,r.kt)("inlineCode",{parentName:"p"},"wsgi.py"),"\nfile).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the same directory, run ",(0,r.kt)("inlineCode",{parentName:"p"},"chmod +x run.fcgi"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the same directory, create another file called ",(0,r.kt)("inlineCode",{parentName:"p"},".htaccess")," with these contents:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-apacheconf"},'RewriteEngine on\nRewriteBase /\nRewriteCond %{REQUEST_FILENAME} !-f\n# Change "user" and "django" to your username and whatever directory\n# name you made in public_html, respectively.\nRewriteRule ^(.*)$ /~user/django/run.fcgi/$1 [QSA,L]\n')))),(0,r.kt)("p",null,"Your app should now be accessible! Note that you will likely have to add\n",(0,r.kt)("inlineCode",{parentName:"p"},"'www.ocf.berkeley.edu'")," to the list of ",(0,r.kt)("inlineCode",{parentName:"p"},"ALLOWED_HOSTS")," in your application's\nsettings."),(0,r.kt)("h3",{id:"making-assets-available"},"Making assets available"),(0,r.kt)("p",null,"While your application may load, things like images, stylesheets and javascript\nmight still be failing to load. Generally, the best way to get these to load is\nto set the following settings in your application:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"STATIC_URL = '/~user/app/static/'\nSTATIC_ROOT = '/home/u/us/user/public_html/django/static'\n")),(0,r.kt)("p",null,"Make sure to change ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"STATIC_URL")," to the correct paths, same\nwith ",(0,r.kt)("inlineCode",{parentName:"p"},"u/us/user")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"django")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"STATIC_ROOT"),"."),(0,r.kt)("p",null,"Then, to generate assets in ",(0,r.kt)("inlineCode",{parentName:"p"},"STATIC_ROOT"),", run ",(0,r.kt)("inlineCode",{parentName:"p"},"venv/bin/python manage.py collectstatic")," from the root of your application, and your assets will be\ncopied to the correct location. This should be done after changing your\napplication or adding/removing static assets."),(0,r.kt)("h3",{id:"debugging"},"Debugging"),(0,r.kt)("p",null,"If you see an error page when trying to load your app, you may find the\nwebserver's logs useful. You can access them in the following locations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"error log: ",(0,r.kt)("inlineCode",{parentName:"li"},"/opt/httpd/error.log")," (most useful)"),(0,r.kt)("li",{parentName:"ul"},"suexec log: ",(0,r.kt)("inlineCode",{parentName:"li"},"/opt/httpd/suexec.log")," (only useful in rare cases)")),(0,r.kt)("p",null,"Once your app has started running, changes you make to the Python code or\ntemplates won't take effect for a few hours. To apply changes immediately, the\nwebserver needs to see that the ",(0,r.kt)("inlineCode",{parentName:"p"},"run.fcgi")," file has changed. You can can change\nthe modification time of the ",(0,r.kt)("inlineCode",{parentName:"p"},"run.fcgi")," file to trigger a restart with the\ncommand:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"user@tsunami:~$ touch ~/public_html/django/run.fcgi\n")))}c.isMDXComponent=!0}}]);