"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3770],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,y=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(y,i(i({ref:t},u),{},{components:n})):r.createElement(y,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7177:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>p,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={title:"Python (Django, Flask, etc.)"},i=void 0,p={unversionedId:"services/webapps/python",id:"services/webapps/python",title:"Python (Django, Flask, etc.)",description:"Note: This document only applies to student groups with virtual hosts who",source:"@site/docs/services/webapps/python.md",sourceDirName:"services/webapps",slug:"/services/webapps/python",permalink:"/docs/services/webapps/python",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/webapps/python.md",tags:[],version:"current",frontMatter:{title:"Python (Django, Flask, etc.)"},sidebar:"tutorialSidebar",previous:{title:"Node.js",permalink:"/docs/services/webapps/nodejs"},next:{title:"Ruby on Rails",permalink:"/docs/services/webapps/rails"}},s={},l=[{value:"Setting up a virtualenv",id:"setting-up-a-virtualenv",level:2},{value:"Installing gunicorn",id:"installing-gunicorn",level:2},{value:"Preparing your app to be supervised",id:"preparing-your-app-to-be-supervised",level:2},{value:"Supervise your app with systemd",id:"supervise-your-app-with-systemd",level:2},{value:"Bonus Gunicorn tip: reloading your app",id:"bonus-gunicorn-tip-reloading-your-app",level:3},{value:"Suggestions/improvements?",id:"suggestionsimprovements",level:2}],u={toc:l};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note: This document only applies to student groups with virtual hosts who\nhave applied for apphosting. For normal user accounts or for groups without\napphosting, you'll want to host with FastCGI instead. See our instructions for\n",(0,a.kt)("a",{parentName:"strong",href:"/docs/services/web/django"},"Django")," or ",(0,a.kt)("a",{parentName:"strong",href:"/docs/services/web/flask"},"Flask"),".")),(0,a.kt)("p",null,"You will want to deploy your application using a virtualenv so that you can\neasily install and manage dependencies and versions."),(0,a.kt)("h2",{id:"setting-up-a-virtualenv"},"Setting up a virtualenv"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create a directory for your app to live in:"),(0,a.kt)("p",{parentName:"li"},"mkdir -p ~/myapp\ncd ~/myapp")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Set up a virtualenv:"),(0,a.kt)("p",{parentName:"li"},"virtualenv venv")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Activate the virtualenv:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},". venv/bin/activate\n")),(0,a.kt)("p",{parentName:"li"},"You should do this step every time before running your app or managing\ninstalled packages.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Copy your code to ",(0,a.kt)("inlineCode",{parentName:"p"},"~/myapp/src")," or similar, and install any dependencies\nusing ",(0,a.kt)("inlineCode",{parentName:"p"},"pip"),"."))),(0,a.kt)("h2",{id:"installing-gunicorn"},"Installing gunicorn"),(0,a.kt)("p",null,"We recommend using gunicorn to serve your application. After activating your\nvirtualenv, install it with ",(0,a.kt)("inlineCode",{parentName:"p"},"pip install gunicorn"),"."),(0,a.kt)("p",null,'Note that you may see a warning about a syntax error. As long as the output\nends in "Successfully installed gunicorn", ',(0,a.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/25611194"},"it's safe to ignore\nthis"),"."),(0,a.kt)("h2",{id:"preparing-your-app-to-be-supervised"},"Preparing your app to be supervised"),(0,a.kt)("p",null,"Create a file at ",(0,a.kt)("inlineCode",{parentName:"p"},"~/myapp/run")," with content like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"#!/bin/bash -e\n. ~/myapp/venv/bin/activate\nPYTHONPATH=~/myapp/src:$PYTHONPATH \\\n    exec gunicorn -w 2 -b unix:/srv/apps/$(whoami)/$(whoami).sock \\\n    --log-file - main:app\n")),(0,a.kt)("p",null,"Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"main:app")," with the module containing the app, and name of your app,\nthen make ",(0,a.kt)("inlineCode",{parentName:"p"},"run")," executable:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chmod +x ~/myapp/run\n")),(0,a.kt)("p",null,"Test executing the run script. You should be able to access your website while\nrunning it (or see any errors in your terminal)."),(0,a.kt)("h2",{id:"supervise-your-app-with-systemd"},"Supervise your app with systemd"),(0,a.kt)("p",null,"Cool, your app works. ",(0,a.kt)("a",{parentName:"p",href:"/docs/services/webapps#supervise"},"Set up systemd")," to\nsupervise your app (so that it starts and restarts automatically)."),(0,a.kt)("h3",{id:"bonus-gunicorn-tip-reloading-your-app"},"Bonus Gunicorn tip: reloading your app"),(0,a.kt)("p",null,"Gunicorn will reload your app if you send it SIGHUP. You can teach systemd that\nfact by adding the following line under ",(0,a.kt)("inlineCode",{parentName:"p"},"[Service]")," in your systemd unit file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ExecReload=/bin/kill -HUP $MAINPID\n")),(0,a.kt)("p",null,"and then running ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl --user daemon-reload"),". After that, you can use\n",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl")," to reload your app:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"systemctl --user reload myapp\n")),(0,a.kt)("h2",{id:"suggestionsimprovements"},"Suggestions/improvements?"),(0,a.kt)("p",null,"If you have a better way to host Python-based apps on the app server (or a\nsuggestion for how we could improve this documentation), ",(0,a.kt)("a",{parentName:"p",href:"/docs/contact"},"send us an email"),"!"))}c.isMDXComponent=!0}}]);