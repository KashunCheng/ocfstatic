"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9375],{3905:(e,t,r)=>{r.d(t,{Zo:()=>l,kt:()=>f});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),c=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},l=function(e){var t=c(e.components);return n.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,s=e.originalType,u=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),d=c(r),f=o,h=d["".concat(u,".").concat(f)]||d[f]||p[f]||s;return r?n.createElement(h,a(a({ref:t},l),{},{components:r})):n.createElement(h,a({ref:t},l))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=d;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<s;c++)a[c]=r[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},1072:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=r(7462),o=(r(7294),r(3905));const s={title:"Restarting services"},a=void 0,i={unversionedId:"staff/procedures/restarting-services",id:"staff/procedures/restarting-services",title:"Restarting services",description:"Taking production services offline",source:"@site/docs/staff/procedures/restarting-services.md",sourceDirName:"staff/procedures",slug:"/staff/procedures/restarting-services",permalink:"/docs/staff/procedures/restarting-services",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/procedures/restarting-services.md",tags:[],version:"current",frontMatter:{title:"Restarting services"},sidebar:"tutorialSidebar",previous:{title:"Process accounting",permalink:"/docs/staff/procedures/process-accounting"},next:{title:"Setting up bridging and link aggregation",permalink:"/docs/staff/procedures/setting-up-lacp"}},u={},c=[{value:"Taking production services offline",id:"taking-production-services-offline",level:2},{value:"Rebooting hypervisors",id:"rebooting-hypervisors",level:2}],l={toc:c};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"taking-production-services-offline"},"Taking production services offline"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"As established by the SMs on August 30, 2017.")),(0,o.kt)("p",null,"Staffers who wish to take any production service offline for longer than the\nlength of a reboot, or who wish to reboot a hypervisor hosting production\nservices must gain permission from the Site Managers or Deputy Site Managers\nwhenever possible."),(0,o.kt)("p",null,"Whenever a staffer restarts a production service, whether permission is\nrequired or not, or restarts a machine that other users have running processes\non, they must give notice to other staffers of their actions as soon as\npossible and ideally receive acknowledgement. The staffer should preferably do\nthis on IRC/Slack."),(0,o.kt)("p",null,"Staffers scheduling downtime for public-facing services should make a blog post\nat ",(0,o.kt)("a",{parentName:"p",href:"https://status.ocf.berkeley.edu"},"status.ocf.berkeley.edu")," to give users sufficient advance notice.\nPlanned restarts of hypervisors should also be announced on this blog, since\nrestarting hypervisors can often take several minutes or more."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"End of policy")),(0,o.kt)("h2",{id:"rebooting-hypervisors"},"Rebooting hypervisors"),(0,o.kt)("p",null,"Rebooting hypervisors is a slightly risky business. Hypervisors aren't\nguaranteed to always reboot without problems. Therefore, you shouldn't reboot\nthem unless you can physically access the lab in case problems arise.\nAdditionally, this risk is the reason (D)SM permission is normally required to\nreboot hypervisors."),(0,o.kt)("p",null,"So you've gotten the necessary permission and made a post on the\n",(0,o.kt)("a",{parentName:"p",href:"https://status.ocf.berkeley.edu"},"status blog"),"/updated the MOTD (if it's a scheduled restart). What now?"),(0,o.kt)("p",null,"If you are planning to shut down login servers (i.e. tsunami, vampires and\ncorruption), run the ",(0,o.kt)("inlineCode",{parentName:"p"},"shutdown")," command on these machines as soon as possible in\norder to schedule the shutdown and warn users in advance. You can do this with\na command like"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'sudo shutdown -h 22:00 "Rebooting for kernel upgrades"\n')),(0,o.kt)("p",null,"for a shutdown scheduled for 10:00pm."),(0,o.kt)("p",null,"For other VMs, you can shut them each down via ",(0,o.kt)("inlineCode",{parentName:"p"},"sudo virsh shutdown"),"."),(0,o.kt)("p",null,"Be careful to ",(0,o.kt)("strong",{parentName:"p"},"always shut down firestorm last"),". This is because once\nfirestorm is shut down, LDAP/Kerberos logins go offline, and the hypervisors can\nthereafter only be logged into via the root account. Since you'll not be able to\nrun new commands using sudo, you should always ",(0,o.kt)("inlineCode",{parentName:"p"},"sudo -i")," before shutting down\nfirestorm."),(0,o.kt)("p",null,"Once all of the VMs have been shut down, you can then power off the hypervisors\nvia ",(0,o.kt)("inlineCode",{parentName:"p"},"shutdown -h now"),"."))}p.isMDXComponent=!0}}]);