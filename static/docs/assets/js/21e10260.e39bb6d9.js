"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6900],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),h=l(n),u=o,f=h["".concat(s,".").concat(u)]||h[u]||d[u]||a;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<a;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1249:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var r=n(7462),o=(n(7294),n(3905));const a={title:"Managed switches"},i=void 0,c={unversionedId:"staff/backend/switch",id:"staff/backend/switch",title:"Managed switches",description:"We use an Arista 7050SX-64 10GbE switch as a primary switch",source:"@site/docs/staff/backend/switch.md",sourceDirName:"staff/backend",slug:"/staff/backend/switch",permalink:"/docs/staff/backend/switch",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/backend/switch.md",tags:[],version:"current",frontMatter:{title:"Managed switches"},sidebar:"tutorialSidebar",previous:{title:"Request Tracker",permalink:"/docs/staff/backend/rt"},next:{title:"Getting Involved",permalink:"/docs/staff/getinvolved"}},s={},l=[{value:"Administering the switch",id:"administering-the-switch",level:2},{value:"Configuring LACP",id:"configuring-lacp",level:3}],p={toc:l};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"We use an ",(0,o.kt)("a",{parentName:"p",href:"https://www.arista.com/assets/data/pdf/Datasheets/7050SX-128_64_Datasheet.pdf"},"Arista 7050SX-64")," 10GbE switch as a primary switch\nfor our servers, and two ",(0,o.kt)("a",{parentName:"p",href:"https://www.arista.com/assets/data/pdf/Datasheets/7048T-A_DataSheet.pdf"},"Arista 7048T-A")," 1GbE switches for\ndesktops and management respectively. These devices were donated to us by\nArista Networks in Fall 2018. Each device in the lab connects first to the back\nof a patch panel, and then from a port on the patch panel to a port on one of\nthe 7048T-As via Cat6. The servers connect directly to the 7050SX via SFP+ DACs,\nas does our uplink to IST, through a Cat6 to 1GbE SFP+ converter. The 7048T's\nconnect to the 7050SX through their SFP+ uplink ports."),(0,o.kt)("p",null,"We do not currently use many of the managed features of the switches, mostly using\nthem to provide layer 2 connectivity. Our previous switch, a Cisco Catalyst 2960S,\nwas used for some time to drop ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Bridge_Protocol_Data_Unit"},"Spanning-tree protocol BPDUs")," and ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol"},"IPv6 Router Advertisements"),"\non all ports, as they caused network configuration problems on our end (creating loops\nwith IST, or hosts autoconfiguring themselves via SLAAC)."),(0,o.kt)("p",null,"The one advanced feature that we do use on our primary switch is LACP. All of our\nhypervisors use Solarflare SFN8522-R2 dual-port 10GbE SFP+ NICs. Both ports are plugged\ninto the switch, with each hypervisor occupying a vertical pair of switch ports. Each\nvertical pair is configured into a channel-group and port-channel, numbered according\nto the index of the pair, e.g. ports Ethernet 31 and Ethernet 32 are aggregated into\nport-channel 16. The hypervisors are then configured to bond the two interfaces in LACP mode."),(0,o.kt)("p",null,"In the future, we'd like to make use of some of the more advanced features\navailable on our switches, such as Port Security, to do things like preventing\ndesktops from spoofing servers, or using layer 3 functionality to support NAT on\nthe desktops and other devices."),(0,o.kt)("h2",{id:"administering-the-switch"},"Administering the switch"),(0,o.kt)("p",null,"The primary switch is named ",(0,o.kt)("inlineCode",{parentName:"p"},"blackhole")," and can be accessed over SSH from inside\nthe OCF subnet."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ssh admin@blackhole.ocf.berkeley.edu\nPassword:\nblackhole.ocf.berkeley.edu>\n")),(0,o.kt)("p",null,"The switches can also be administered directly by connecting to their console port\nwith a USB serial console cable."),(0,o.kt)("p",null,'After logging in, one can enter an advanced configuration mode by typing "',(0,o.kt)("inlineCode",{parentName:"p"},"enable"),'",\nand then, before configuring specific interfaces, type "',(0,o.kt)("inlineCode",{parentName:"p"},"config"),'".'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"blackhole.ocf.berkeley.edu> enable\nblackhole.ocf.berkeley.edu# config\nblackhole.ocf.berkeley.edu(config)# interface Ethernet 31-32\nblackhole.ocf.berkeley.edu(config-if-Et31-32)#\n")),(0,o.kt)("h3",{id:"configuring-lacp"},"Configuring LACP"),(0,o.kt)("p",null,"After identifying which interfaces need to be aggregated into an LACP group on the\nswitch and calculating the group index, enter config mode and do the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"blackhole.ocf.berkeley.edu(config)# interface Ethernet 31-32\nblackhole.ocf.berkeley.edu(config-if-Et31-32)# channel-group 16 mode active\nblackhole.ocf.berkeley.edu(config-if-Et31-32)# lacp rate fast\nblackhole.ocf.berkeley.edu(config-if-Et31-32)# interface port-channel 16\nblackhole.ocf.berkeley.edu(config-if-Po16)#\n")),(0,o.kt)("p",null,"at this point, one can use ",(0,o.kt)("inlineCode",{parentName:"p"},"show port-channel")," to observe the basic state of the\naggregation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"blackhole.ocf.berkeley.edu(config-if-Po7)#show port-channel\nPort Channel Port-Channel5:\n  Active Ports: Ethernet10 Ethernet9\nPort Channel Port-Channel7:\n  No Active Ports\n  Configured, but inactive ports:\n       Port          Reason unconfigured\n    ---------------- -------------------------\n       Ethernet13    Waiting for LACP response\n       Ethernet14    Waiting for LACP response\n\n")),(0,o.kt)("p",null,"More details can be found on the EOS guide online, in the ",(0,o.kt)("a",{parentName:"p",href:"https://www.arista.com/en/um-eos/eos-port-channels-and-lacp"},"Port Channel section"),"."),(0,o.kt)("p",null,"LACP also needs to be configured on the ",(0,o.kt)("a",{parentName:"p",href:"/docs/staff/procedures/setting-up-lacp"},"host side"),"."))}d.isMDXComponent=!0}}]);