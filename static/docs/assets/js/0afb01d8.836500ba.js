"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[4124],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,k=u["".concat(s,".").concat(d)]||u[d]||m[d]||i;return a?n.createElement(k,o(o({ref:t},c),{},{components:a})):n.createElement(k,o({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3148:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={title:"Request Tracker"},o=void 0,l={unversionedId:"staff/rebuild/rt",id:"staff/rebuild/rt",title:"Request Tracker",description:"Note: RT is now deployed as a Kubernetes service running in Docker, so",source:"@site/docs/staff/rebuild/rt.md",sourceDirName:"staff/rebuild",slug:"/staff/rebuild/rt",permalink:"/docs/staff/rebuild/rt",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/staff/rebuild/rt.md",tags:[],version:"current",frontMatter:{title:"Request Tracker"},sidebar:"tutorialSidebar",previous:{title:"Rebuild",permalink:"/docs/staff/rebuild/"},next:{title:"Scripts",permalink:"/docs/staff/scripts/"}},s={},p=[{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Notes",id:"notes",level:2},{value:"Todo",id:"todo",level:2},{value:"References",id:"references",level:2}],c={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," RT is now deployed as a Kubernetes service running in Docker, so\nthese instructions aren't super useful for OCF staff. This page is kept as a\nreference for others who might come across it (it ranks pretty highly on\nGoogle). If you're one of these people, you might find one of these useful:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/ocf/puppet/tree/fc6d4242ba773cefbc9e7c1ea542f8f7de3e8785/modules/ocf_rt"},"Our Puppet code for installing RT."),"\nWe don't actually use this anymore, but it should be reasonably modern and\nworked well for us for a long time.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/ocf/rt"},"Our Dockerized RT service."),"\nWe run this on Kubernetes, but you should easily be able to get it running\non something like Mesos/Marathon or Docker Swarm, too."))),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"Both Apache 2 and Nginx installation are listed below. Pick your poison..."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install required packages:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo aptitude install mysql-server\nsudo aptitude install -t squeeze-backports request-tracker4 rt4-db-mysql\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Apache 2:")," Install"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo install libapache-mod-auth-kerb\nsudo install -t squeeze-backports rt4-apache\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Nginx:")," Install"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo install -t squeeze-backports nginx rt4-fcgi\n")),(0,r.kt)("p",{parentName:"li"},"and enable the RT FastCGI daemon: in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/default/rt4-fcgi"),", edit:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"enabled=1\n")),(0,r.kt)("p",{parentName:"li"},"Debian packages an obscenely old version of Nginx in stable, so please don't\ninstall that. People will laugh at you."),(0,r.kt)("p",{parentName:"li"},"Configuration by debconf:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Name: rt.ocf.berkeley.edu"),(0,r.kt)("li",{parentName:"ul"},"Handle RT_SiteConfig.pm permissions: yes"),(0,r.kt)("li",{parentName:"ul"},"SQL password: ....")),(0,r.kt)("p",{parentName:"li"},"Install RT::Extension::CommandByMail and RT::Extension::MergeUsers:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo cpan\ncpan> install RT::Extension::CommandByMail\ncpan> notest install RT::Extension::MergeUsers\n")),(0,r.kt)("p",{parentName:"li"},"When prompted, the RT lib folder is located at\n",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/request-tracker4/lib"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy site-specific RT configuration into\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/request-tracker4/RT_SiteConfig.d/99-ocf"),": (this should be puppeted)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-perl"},"# Debug - commented out for now\n#Set($LogToSTDERR, \"debug\");\n#Set($LogToSyslog, \"debug\");\n\nSet($WebDomain, 'rt.ocf.berkeley.edu');\nSet($WebBaseURL , \"https://rt.ocf.berkeley.edu\");\nSet($WebPort, 443);\n\n# Use external authentication provided by mod_auth_kerb\nSet($WebExternalAuth , 1);\nSet($WebFallbackToInternalAuth, 1);\n# tells RT to create users automatically if no user matching REMOTE_USER is found\nSet($WebExternalAuto, 1);\nSet($WebExternalGecos, undef);\n\n# Plugins\nSet(@MailPlugins, qw(Auth::MailFrom Filter::TakeAction));\nSet(@Plugins,(qw(RT::Extension::CommandByMail RT::Extension::MergeUsers)));\n\n# Make links clicky\nSet(@Active_MakeClicky, qw(httpurl_overwrite));\n\n# Non-fail To addresses\nSet($UseFriendlyToLine, 1);\n\n# Enable fulltext\nSet( %FullTextSearch,\n    Enable     => 1,\n    Indexed    => 1,\n    Table      => 'AttachmentsIndex',\n    MaxMatches => '10000',\n);\n\n# Use plain text instead of HTML email\nSet($MessageBoxRichText, undef);\nSet($PreferRichText, undef);\n")),(0,r.kt)("p",{parentName:"li"},"Regenerate the resultant ",(0,r.kt)("inlineCode",{parentName:"p"},"RT_SiteConfig.pm")," file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo update-rt-siteconfig\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure that SSL certificates for ",(0,r.kt)("inlineCode",{parentName:"p"},"rt.ocf.berkeley.edu")," exist at the\nfollowing locations:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Certificate: ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/ssl/private/rt_ocf_berkeley_edu.crt")),(0,r.kt)("li",{parentName:"ul"},"Certificate chain/bundle: ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/ssl/private/incommon.crt")),(0,r.kt)("li",{parentName:"ul"},"Private key: ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/ssl/private/rt_ocf_berkeley_edu.key"))),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Nginx only:"),' Create a "chained" certificate file:'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"cat rt_ocf_berkeley_edu.crt incommon.crt > rt_ocf_berkeley_edu.chained.crt\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Apache 2:")," Copy the following RT configuration file ",(0,r.kt)("inlineCode",{parentName:"p"},"rt")," into\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available")," and link to it from\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-enabled")," (replace typhoon.ocf.berkeley.edu with the FQDN\nreported by ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname -f"),"):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-apache"},'# Apache configuration file for RT\n\n<VirtualHost *:80>\n        ServerName rt.ocf.berkeley.edu\n        RewriteEngine On\n        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]\n</VirtualHost>\n\n<VirtualHost *:443>\n        ServerName rt.ocf.berkeley.edu\n\n        SSLEngine on\n        SSLCertificateFile /etc/ssl/private/rt_ocf_berkeley_edu.crt\n        SSLCertificateChainFile /etc/ssl/private/incommon.crt\n        SSLCertificateKeyFile /etc/ssl/private/rt_ocf_berkeley_edu.key\n\n        Alias /rt /usr/share/request-tracker4/html\n        RedirectMatch ^/$ /rt\n\n        <Location /rt>\n                SetHandler modperl\n                PerlResponseHandler Plack::Handler::Apache2\n                PerlSetVar psgi_app /usr/share/request-tracker4/libexec/rt-server\n\n                # Comment this to enable RT-local root\n                AuthType Kerberos\n                Require valid-user\n                KrbMethodNegotiate On\n                KrbMethodK5Passwd On\n                KrbLocalUserMapping On\n                KrbServiceName HTTP/typhoon.ocf.berkeley.edu\n                Krb5KeyTab /etc/apache2/sites-available/rt.keytab\n        </Location>\n\n        <Location /rt/REST/1.0/NoAuth>\n                # No Kerberos - for rt-mailgate\n                Satisfy Any\n                Order Allow,Deny\n                Allow from 128.32.129.218 # sandstorm.ocf.berkeley.edu\n        </Location>\n\n        <Location /rt/NoAuth>\n                # No Kerberos - login/logout pages\n                Satisfy Any\n                Order Allow,Deny\n                Allow from All\n        </Location>\n\n        <Perl>\n                use Plack::Handler::Apache2;\n                Plack::Handler::Apache2->preload("/usr/share/request-tracker4/libexec/rt-server");\n        </Perl>\n\n</VirtualHost>\n')),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Nginx:")," Copy the following RT configuration file ",(0,r.kt)("inlineCode",{parentName:"p"},"rt")," into\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available")," and link to it from ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-enabled"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-nginx"},'# Configuration for RT on Nginx\n# rt.ocf.berkeley.edu\n\nserver {\n        listen 80;\n        server_name rt.ocf.berkeley.edu;\n        rewrite ^ https://$server_name$request_uri? permanent;\n}\n\nserver {\n        listen 443;\n        server_name rt.ocf.berkeley.edu;\n        rewrite ^/$ /rt;\n\n        root /usr/share/request-tracker4;\n\n        location /rt {\n                # See /usr/share/doc/rt4-fcgi/examples/request-tracker4.conf\n                expires epoch;\n\n                # Require the default authentication on typhoon (pam_krb5)\n                auth_pam "RT";\n                auth_pam_service_name "common-password";\n\n                # Proxy over to rt4.\n                fastcgi_pass unix:/var/run/rt4-fcgi.sock;\n                include /etc/nginx/fastcgi_params;\n                fastcgi_param REMOTE_USER $remote_user;\n                fastcgi_param SCRIPT_NAME "/rt";\n        }\n\n        # Bypass FastCGI for images\n        location /rt/NoAuth/images {\n                alias           /usr/share/request-tracker4/html/NoAuth/images/;\n        }\n\n        location /rt/REST/1.0/NoAuth {\n                allow           128.32.129.218; # sandstorm.ocf.berkeley.edu\n                deny            all;\n\n                fastcgi_pass unix:/var/run/rt4-fcgi.sock;\n                include /etc/nginx/fastcgi_params;\n                fastcgi_param REMOTE_USER $remote_user;\n                fastcgi_param SCRIPT_NAME "/rt";\n        }\n\n        ssl on;\n\n        # Same as apache\n        ssl_certificate /etc/ssl/private/rt_ocf_berkeley_edu.chained.crt;\n        ssl_certificate_key /etc/ssl/private/rt_ocf_berkeley_edu.key;\n\n        ssl_session_timeout 5m;\n        ssl_session_cache shared:SSL:10m;\n\n        ssl_protocols SSLv3 TLSv1;\n        ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;\n        ssl_prefer_server_ciphers on;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Apache 2 only:")," Obtain a keytab for the principal\nHTTP/",(0,r.kt)("a",{parentName:"p",href:"mailto:typhoon.ocf.berkeley.edu@OCF.BERKELEY.EDU"},"typhoon.ocf.berkeley.edu@OCF.BERKELEY.EDU")," (replace\ntyphoon.ocf.berkeley.edu with the FQDN reported by ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname -f"),") and place\nit into ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/rt.keytab"),". Make sure it's only\nreadable by www-data.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"mod_auth_kerb/ngx_http_auth_pam uses HTTP Basic authorization which has no\nconcept of login/logout. Emulate logout behavior by changing the Logout page\nto send a 401 (works for Chrome), run proprietary IE code (works for IE),\nand make an Ajax call to a non-existing page with bad credentials (works for\nFirefox)."),(0,r.kt)("p",{parentName:"li"},'The below code has been "adapted" from ',(0,r.kt)("a",{parentName:"p",href:"https://trac-hacks.org/wiki/TrueHttpLogoutPatch"},"https://trac-hacks.org/wiki/TrueHttpLogoutPatch")),(0,r.kt)("p",{parentName:"li"},"This should be fixed so that RT's installation files aren't being directly modified."),(0,r.kt)("p",{parentName:"li"},"Edit ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/share/request-tracker4/html/NoAuth/Logout.html"),":"),(0,r.kt)("p",{parentName:"li"},"Change"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"<& /Elements/Header, Title => loc('Logout'), Refresh => RT->Config->Get('LogoutRefresh') &>\n")),(0,r.kt)("p",{parentName:"li"},"to"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"<& /Elements/Header, Title => loc('Logout') &>\n")),(0,r.kt)("p",{parentName:"li"},"and paste the following below it:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'<script type="text/javascript">\nfunction clearAuthenticationCache() {\n  try {\n    var agent = navigator.userAgent.toLowerCase();\n    if (agent.indexOf("msie") != -1) {\n      // This works only on IE only.\n      document.execCommand("ClearAuthenticationCache");\n    }\n    else {\n      var xml = createXMLObject();\n      // Let\'s prepare invalid credentials\n      xml.open("GET", Math.random().toString(), true, "logout", "logout");\n      xml.send("");\n      xml.abort();\n    }\n  } catch (e) {\n    return;\n  }\n}\n\nfunction createXMLObject() {\n  try {\n    if (window.XMLHttpRequest) {\n      xml = new XMLHttpRequest();\n    }\n    else if (window.ActiveXObject) {\n      xml = new ActiveXObject("Microsoft.XMLHTTP");\n    }\n  } catch (e) {\n    xml = false\n  }\n  return xml;\n}\n\nclearAuthenticationCache();\n<\/script>\n')),(0,r.kt)("p",{parentName:"li"},"Add the following before the end of the <%INIT> block at the end of the file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'# "Force" logout due to using mod_auth_kerb -- Chrome\n$HTML::Mason::Commands::r->status(401);\n')),(0,r.kt)("p",{parentName:"li"},"Clear the RT Mason cache."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo rm -rf /var/cache/request-tracker4/*\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Apache 2:")," Restart Apache."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"For Nginx:")," Restart the RT FastCGI daemon."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo service rt4-fcgi restart\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the RT ",(0,r.kt)("a",{parentName:"p",href:"https://rt-wiki.bestpractical.com/wiki/EmailInterface#RT.27s_mail_gate"},"mailgate\nprogram"),"\non the mail server."),(0,r.kt)("p",{parentName:"li"},"squeeze-backports is required here too."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo aptitude install rt4-clients\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set up ",(0,r.kt)("a",{parentName:"p",href:"mailto:rt@ocf.berkeley.edu"},"rt@ocf.berkeley.edu")," to feed mail into rt-mailgate."),(0,r.kt)("p",{parentName:"li"},"Add or edit the following lines into ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/mail/aliases/aliases"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'rt: "|/usr/bin/rt-mailgate --queue General --action correspond --url https://rt.ocf.berkeley.edu/rt"\nrt-comment: "|/usr/bin/rt-mailgate --queue General --action comment --url https://rt.ocf.berkeley.edu/rt"\n')))),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The RT root user can't log in while Kerberos password authentication is\nenabled because of the way ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_auth_kerb/ngx_http_auth_pam")," works. So, you\nmust first log in with Kerberos credentials to create a user from Kerberos\nand grant superuser rights on it."),(0,r.kt)("p",{parentName:"li"},"Log in to RT. You will be auto-created and redirected to Self-Service.\nDisable Kerberos password authentication:"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Apache 2:")," Comment out the following lines in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/apache2/sites-available/rt"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"# AuthType Kerberos\n# Require valid-user\n")),(0,r.kt)("p",{parentName:"li"},"and force-reload Apache configuration (",(0,r.kt)("inlineCode",{parentName:"p"},"service apache2 force-reload"),")."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Nginx:")," Comment out the following lines in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/rt"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'# auth_pam "RT";\n# auth_pam_service_name "common-password";\n')),(0,r.kt)("p",{parentName:"li"},"and restart Nginx (",(0,r.kt)("inlineCode",{parentName:"p"},"service nginx restart"),").")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Visit RT again and log in as RT root."),(0,r.kt)("p",{parentName:"li"},'Go to Tools > Configuration > Users > Select, and type in your username in\n"Go to user". Enable ',(0,r.kt)("strong",{parentName:"p"},"Let this user be granted rights (Privileged)"),"."),(0,r.kt)("p",{parentName:"li"},"Go to Tools > Configuration > Global > User Rights. On the left side, in Add\nUser, type your name. Then, on the right side, click the tab ",(0,r.kt)("strong",{parentName:"p"},"Rights for\nAdministrators"),", and enable ",(0,r.kt)("strong",{parentName:"p"},"Do anything and everything"),"."),(0,r.kt)("p",{parentName:"li"},"Save changes."),(0,r.kt)("p",{parentName:"li"},"You will want to remove your superuser powers later because superusers may\nbe artificially limited in rights elsewhere on RT for your own protection:\n",(0,r.kt)("a",{parentName:"p",href:"https://rt-wiki.bestpractical.com/wiki/SuperUser"},'"Starting from version 3.2 (or 3.4?) RT doesn\'t show users with the\nSuperUser right in a ticket owner\nselect-box."')),(0,r.kt)("p",{parentName:"li"},"Re-enable Kerberos password authentication in Apache configuration and\nforce-reload Apache.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create groups. I've created root and staff groups; this configuration may\nchange as our use of RT is refined."),(0,r.kt)("p",{parentName:"li"},'Go to Tools > Configuration > Groups > Create and create "Root" and "Staff"\ngroups.'),(0,r.kt)("p",{parentName:"li"},"Add users to these groups by the ",(0,r.kt)("strong",{parentName:"p"},"Members")," subsection in the upper right\ncorner of the group modification page. (You can also alter a user's group\nmemberships from the user's modification page.)"),(0,r.kt)("p",{parentName:"li"},'In this configuration I see the set of RT privileged users to be the same as\nthe set of users in group "Staff". This may change.')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enable user rights. ",(0,r.kt)("a",{parentName:"p",href:"https://rt-wiki.bestpractical.com/wiki/Rights"},"This"),"\nguide is being followed."),(0,r.kt)("p",{parentName:"li"},"Go to Tools > Configuration > Global > Group Rights."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Save your changes each time you make changes to a group's rights.")),(0,r.kt)("p",{parentName:"li"},"Make sure the selected group is ",(0,r.kt)("strong",{parentName:"p"},"Everyone"),"."),(0,r.kt)("p",{parentName:"li"},"Select the following rights:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Comment on tickets"),(0,r.kt)("li",{parentName:"ul"},"Create tickets"),(0,r.kt)("li",{parentName:"ul"},"Reply to tickets"),(0,r.kt)("li",{parentName:"ul"},"View queue"),(0,r.kt)("li",{parentName:"ul"},"View ticket summaries")),(0,r.kt)("p",{parentName:"li"},"Now add a group to add permissions to, from the bottom left: Add Group"),(0,r.kt)("p",{parentName:"li"},'Add these rights to "Staff", in the "Rights for Staff" tab:'),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Delete tickets"),(0,r.kt)("li",{parentName:"ul"},"Modify one's own RT account"),(0,r.kt)("li",{parentName:"ul"},"Modify tickets"),(0,r.kt)("li",{parentName:"ul"},"Own tickets"),(0,r.kt)("li",{parentName:"ul"},"Steal tickets"),(0,r.kt)("li",{parentName:"ul"},"Take tickets"),(0,r.kt)("li",{parentName:"ul"},"View private ticket commentary")),(0,r.kt)("p",{parentName:"li"},'Add these rights to "Root", in the "Rights for Administrators" tab:'),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Everything except "Do anything and everything"'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Miscellaneous configuration"),(0,r.kt)("p",{parentName:"li"},"Change RT root's info so he can be a front for staff@. (Tools >\nConfiguration > Users > Select, click root, change email to\n",(0,r.kt)("a",{parentName:"p",href:"mailto:staff@ocf.berkeley.edu"},"staff@ocf.berkeley.edu")," and Real Name to OCF Staff)."),(0,r.kt)("p",{parentName:"li"},'Make the General queue sound better: Tools > Configuration > Queues >\nSelect, click General, change Description to "OCF Staff". (I think changing\nthe Queue Name would be nice too. If you do that, remember to change the\nparameters to rt-mailgate in ',(0,r.kt)("inlineCode",{parentName:"p"},"/var/mail/aliases/aliases")," and re-run\nnewaliases on sandstorm.)"),(0,r.kt)("p",{parentName:"li"},"Add root as a watcher for General so staff@ gets automatically Cc'ed to new\ntickets. Click Watchers in the upper right corner and add root.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Send more mail."),(0,r.kt)("p",{parentName:"li"},"By default RT only sends an autoreply to the requestor on ticket creation.\nCreate a new scrip (RT callback) so that Cc (staff@) gets notified on ticket\ncreation as well."),(0,r.kt)("p",{parentName:"li"},"Create that which is to be mailed: go to Tools > Configuration > Global >\nTemplates > Create."),(0,r.kt)("p",{parentName:"li"},'Create a template with the name "Correspondence Creation" and description\n"For mailing staff on ticket creation, but without all that boilerplate".\nKeep type as "Perl". Paste this in as the content:'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"RT-Attach-Message: yes\nSubject: {$Ticket->Subject}\n\n{$Transaction->Content()}\n")),(0,r.kt)("p",{parentName:"li"},"Save changes."),(0,r.kt)("p",{parentName:"li"},'Modify the scrip "On Create Notify AdminCcs" to use the template "Global Template: Correspondence Creation".')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Send spoofed mail."),(0,r.kt)("p",{parentName:"li"},'Mail in the past has come from actual people, not endless drones of "via\nRT". Let\'s fake that for people who are uncomfortable with change. At the\ntop of Correspondence, Admin Correspondence, Admin Comment, and\nCorrespondence Creation templates, append the following below the last mail\nheader that appears, if any exist:'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'From: {\n  my $u = $Transaction->CreatorObj;\n  my $a = $u->EmailAddress;\n  my $res = $u->RealName || $u->Name;\n  $res .= " <".$a .">" ;\n$res; }\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Automatically close tickets."),(0,r.kt)("p",{parentName:"li"},"This needs to be chained or something to send a template saying that the\nticket is closed because it hasn't been modified in 30 days. I don't know\nwhat this entails, but the below is a start."),(0,r.kt)("p",{parentName:"li"},"Put the following into a crontab; you may want to create a rt system user to\nrun this."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"0 * * * * /usr/bin/rt-crontool --search RT::Search::FromSQL \\\n--search-arg \"LastUpdated < '5 days ago' AND Status = 'stalled'\" \\\n--action RT::Action::SetStatus --action-arg resolved\n")),(0,r.kt)("p",{parentName:"li"},"References:\n",(0,r.kt)("a",{parentName:"p",href:"http://lists.bestpractical.com/pipermail/rt-users/2005-February/028837.html"},"1"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://rt-wiki.bestpractical.com/wiki/UntouchedInHours"},"2"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://rt-wiki.bestpractical.com/wiki/TimedNotifications"},"3")))),(0,r.kt)("h2",{id:"notes"},"Notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"First-time autocreated users will have incorrect/embarrassing Real Names (for\nsome reason, it grabs the gecos on occasion), so that should be fixed upon\nfirst login. Users can also update this information when they feel like it.")),(0,r.kt)("h2",{id:"todo"},"Todo"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix Chrome double login, if possible.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Doesn't occur when running Nginx, only Apache 2."))),(0,r.kt)("li",{parentName:"ul"},"Set up ticket autoclose using\n",(0,r.kt)("a",{parentName:"li",href:"https://rt-wiki.bestpractical.com/wiki/UntouchedInHours"},"https://rt-wiki.bestpractical.com/wiki/UntouchedInHours")," or\n",(0,r.kt)("a",{parentName:"li",href:"https://rt-wiki.bestpractical.com/wiki/TimedNotifications"},"https://rt-wiki.bestpractical.com/wiki/TimedNotifications"))),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://rt-wiki.bestpractical.com/wiki/Main_Page"},"https://rt-wiki.bestpractical.com/wiki/Main_Page"))))}m.isMDXComponent=!0}}]);